import{g as G,E as ae,r as j,G as R,bh as T,an as oe,ab as se,am as re,O as le,m as ue,A as f,B as k,s as t,o as r,h as _,w as u,a as l,b as d,L as U,c as i,F as w,n as D,t as b,q as P,aR as A,d as c,v as F,aE as ie,y as ce,a$ as de,bi as me,bj as _e,bk as z,S as pe,M as fe,T as ve,k as ye,ad as ge,i as he,J as ke}from"./entry.6507cb32.js";import{_ as be}from"./NSelect.vue.9556d6e0.js";import{_ as xe}from"./NLink.vue.ec1f69e3.js";import{_ as we}from"./FilepathItem.vue.84aa0a31.js";import{U as Ce}from"./json-editor-vue.bbdad521.js";import{_ as Ke}from"./AuthRequiredPanel.vue.17c2a7bd.js";const Se={class:"h-[48px] flex items-center justify-between gap1 px-3"},$e={class:"w-full text-sm"},Ve=["value"],Ne=["onClick"],Ie=l("div",{"x-divider":""},null,-1),je={key:0,"h-full":"","of-hidden":"",flex:"~ col"},Ue={border:"b base",class:"h-[49px] flex flex-none items-center justify-between px-4 text-sm"},De={class:"flex items-center gap-4"},Ae={key:1},Be=["onKeyup"],Le=l("br",null,null,-1),Me={key:0,op50:""},qe={key:1},Ee=l("code",null,"nitro.storage",-1),Re=l("br",null,null,-1),Te={"font-bold":""},Pe=l("br",null,null,-1),Fe={"text-sm":""},ze=l("br",null,null,-1),Ge=G({__name:"StorageDetails",async setup(O){let m,g;const C=_e(),h=ae(),x=j(""),v=j(""),s=R("storage:current",""),e=j(),y=R("storage:file:state",""),{data:K}=([m,g]=T(()=>z("storageMounts",()=>f.getStorageMounts())),m=await m,g(),m),{data:S,refresh:B}=([m,g]=T(async()=>z("storageKeys",async()=>s.value?await f.getStorageKeys(s.value):[])),m=await m,g(),m),J=C.hook("storage:key:update",async(n,a)=>{if(!(!s.value||n.split(":")[0]!==s.value)&&(await B(),y.value===n)){if(a==="remove")return h.replace({query:{storage:s.value}});await V(y.value)}});oe(J),se(s,()=>{B(),y.value=""}),re(async()=>{if(!y.value){e.value=null;return}V(y.value)}),le("keydown",n=>{n.key==="s"&&(n.ctrlKey||n.metaKey)&&(N(),n.preventDefault())});function $(n){return n.replace(`${s.value}:`,"")}const W=ue(()=>S.value?S.value.filter(n=>n.includes(x.value)):[]);async function V(n){const a=await f.getStorageItem(await k(),n);e.value={key:n,updatedKey:$(n),editingKey:!1,content:a,updatedContent:a}}async function H(){if(!v.value||!s.value)return;const n=`${s.value}:${v.value}`;S.value?.includes(n)||await f.setStorageItem(await k(),n,""),h.replace({query:{storage:s.value,key:n}}),v.value=""}async function N(){e.value&&(await f.setStorageItem(await k(),e.value.key,e.value.updatedContent),await V(e.value.key))}async function Q(){!e.value||!s.value||(await f.removeStorageItem(await k(),e.value.key),e.value=null)}async function X(){if(!e.value||!s.value)return;const n=`${s.value}:${e.value.updatedKey}`,a=await k();await f.setStorageItem(a,n,e.value.updatedContent),await f.removeStorageItem(a,e.value.key),h.replace({query:{storage:s.value,key:n}})}return(n,a)=>{const Y=pe,Z=be,I=fe,ee=ve,L=ye,M=xe,q=ge,E=he,te=ke,ne=we;return t(s)?(r(),_(te,{key:0,"storage-key":"tab-storage"},{left:u(()=>[l("div",Se,[d(Y,{icon:"carbon-chevron-left","ml--1":"",onClick:a[0]||(a[0]=o=>s.value="")}),l("div",$e,[d(Z,{modelValue:t(s),"onUpdate:modelValue":a[1]||(a[1]=o=>U(s)?s.value=o:null),n:"primary",icon:"carbon-data-base"},{default:u(()=>[(r(!0),i(w,null,D(t(K),(o,p)=>(r(),i("option",{key:p,value:p},b(p),9,Ve))),128))]),_:1},8,["modelValue"])])]),d(I,{modelValue:t(x),"onUpdate:modelValue":a[2]||(a[2]=o=>U(x)?x.value=o:null),icon:"carbon-search",placeholder:"Search...",n:"primary sm",border:"y x-none base! rounded-0",class:"w-full py2 ring-0!"},null,8,["modelValue"]),(r(!0),i(w,null,D(t(W),o=>(r(),i(w,{key:o},[l("button",{block:"","w-full":"",truncate:"",px2:"",py1:"","text-start":"","text-sm":"","font-mono":"",class:P(o===t(e)?.key?"text-primary n-bg-active":"text-secondary hover:n-bg-hover"),onClick:p=>y.value=o},b($(o)),11,Ne),Ie],64))),128)),d(I,{modelValue:t(v),"onUpdate:modelValue":a[3]||(a[3]=o=>U(v)?v.value=o:null),icon:"carbon-add",placeholder:"key",n:"sm",border:"t-none x-none base! rounded-0",class:"w-full py2 font-mono ring-0!",onKeyup:A(H,["enter"])},null,8,["modelValue","onKeyup"])]),right:u(()=>[t(e)?.key?(r(),i("div",je,[l("div",Ue,[l("div",De,[t(e).editingKey?(r(),_(I,{key:0,modelValue:t(e).updatedKey,"onUpdate:modelValue":a[4]||(a[4]=o=>t(e).updatedKey=o),onKeyup:A(X,["enter"])},null,8,["modelValue","onKeyup"])):(r(),i("code",Ae,[c(b($(t(e).key))+" ",1),d(ee,{icon:"carbon-edit",class:"cursor-pointer op50 hover:op100",onClick:a[5]||(a[5]=o=>t(e).editingKey=!0)})])),t(e).editingKey?F("",!0):(r(),_(L,{key:2,n:"green xs",disabled:t(e).content===t(e).updatedContent,class:P({"border-green":t(e).content!==t(e).updatedContent}),onClick:N},{default:u(()=>[c(" Save ")]),_:1},8,["disabled","class"]))]),l("div",null,[d(L,{n:"red xs",onClick:Q},{default:u(()=>[c(" Delete ")]),_:1})])]),typeof t(e).content=="object"?(r(),_(t(Ce),ie({key:0,modelValue:t(e).updatedContent,"onUpdate:modelValue":a[6]||(a[6]=o=>t(e).updatedContent=o),class:[[n.$colorMode.value==="dark"?"jse-theme-dark":"light"],"json-editor-vue h-full of-auto text-sm outline-none"]},n.$attrs,{mode:"text","navigation-bar":!1,indentation:2,"tab-size":2}),null,16,["modelValue","class"])):ce((r(),i("textarea",{key:1,"onUpdate:modelValue":a[7]||(a[7]=o=>t(e).updatedContent=o),placeholder:"Item value...",class:"h-full of-auto p-4 text-sm font-mono outline-none",onKeyup:A(de(N,["ctrl"]),["enter"])},null,40,Be)),[[me,t(e).updatedContent]])])):(r(),_(E,{key:1},{default:u(()=>[d(q,{px6:"",py4:""},{default:u(()=>[c(" Select one key to start."),Le,c("Learn more about "),d(M,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:u(()=>[c(" Nitro storage ")]),_:1})]),_:1})]),_:1}))]),_:1})):(r(),_(E,{key:1},{default:u(()=>[Object.keys(t(K)).length?(r(),i("p",Me," Select one storage to start: ")):(r(),i("p",qe,[c(" No custom storage defined in "),Ee,c("."),Re,c(" Learn more about "),d(M,{href:"https://nitro.unjs.io/guide/storage",n:"orange",target:"_blank"},{default:u(()=>[c(" Nitro storage ")]),_:1})])),(r(!0),i(w,null,D(t(K),(o,p)=>(r(),_(q,{key:p,"min-w-80":"","cursor-pointer":"","p-4":"","text-left":"",hover:"border-green",onClick:Oe=>s.value=p},{default:u(()=>[l("span",Te,b(p),1),Pe,l("span",Fe,b(o.driver)+" driver",1),ze,o.base?(r(),_(ne,{key:0,"text-xs":"",filepath:o.base},null,8,["filepath"])):F("",!0)]),_:2},1032,["onClick"]))),128))]),_:1}))}}}),Ze=G({__name:"storage",setup(O){return(m,g)=>{const C=Ge,h=Ke;return r(),_(h,null,{default:u(()=>[d(C)]),_:1})}}});export{Ze as default};
